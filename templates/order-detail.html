{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/index.css' %}">
<link rel="stylesheet" href="{% static 'css/order.css' %}">
<div class="container">
    <div class="content">
        <div class="order-header">
            <h2 class="order-number">Заказ #{{ order.order_number }}</h2>
            <span class="order-status status-{{ order.status }}">{{ order.get_status_display }}</span>
        </div>

        <div class="order-details">
            <div>
                <div class="detail-section">
                    <h3>Информация о заказе</h3>
                    <div class="detail-row">
                        <span class="detail-label">Дата заказа:</span>
                        <span class="detail-value">{{ order.created_at|date:"d.m.Y H:i" }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Способ доставки:</span>
                        <span class="detail-value">{{ order.get_delivery_type_display }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Тип документа:</span>
                        <span class="detail-value">{{ order.get_document_type_display }}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>Адрес доставки</h3>
                    <div class="detail-value">
                        {{ order.shipping_address|linebreaks }}
                    </div>
                </div>
            </div>

            <div>
                <div class="detail-section">
                    <h3>Платежная информация</h3>
                    <div class="detail-row">
                        <span class="detail-label">Статус оплаты:</span>
                        <span class="detail-value">
                            {% if order.payment_status == 'paid' %}
                            <span style="color: #27ae60;">Оплачен</span>
                            {% else %}
                            <span style="color: #e74c3c;">Ожидает оплаты</span>
                            {% endif %}
                        </span>
                    </div>
                    {% if order.payment_id %}
                    <div class="detail-row">
                        <span class="detail-label">ID платежа:</span>
                        <span class="detail-value">{{ order.payment_id }}</span>
                    </div>
                    {% endif %}
                </div>

                <div class="detail-section">
                    <h3>Примечания</h3>
                    <div class="detail-value">
                        {% if order.notes %}
                        {{ order.notes|linebreaks }}
                        {% else %}
                        Нет примечаний
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="order-items">
            <h2>Товары в заказе</h2>
            <table class="items-table">
                <thead>
                    <tr>
                        <th>Товар</th>
                        <th>Цена</th>
                        <th>Количество</th>
                        <th>Итого</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td>
                            <div class="product-info">
                                {% if item.product.images %}
                                <img src="{{ item.product.images.url }}" alt="{{ item.product.name }}"
                                    class="product-image">
                                {% endif %}
                                <div>
                                    <div class="product-name">{{ item.product.name }}</div>
                                    <div style="color: #7f8c8d; font-size: 14px;">
                                        Алгоритм: {{ item.product.algorithm }}<br>
                                        Хешрейт: {{ item.product.hash_rate }}<br>
                                        Потребление: {{ item.product.power_consumption }}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>${{ item.price }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>${{ item.get_cost }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="order-summary">
                <div class="summary-row">
                    <span class="summary-label">Сумма товаров:</span>
                    <span class="summary-value">${{ order.subtotal }}</span>
                </div>
                {% if order.discount_amount > 0 %}
                <div class="summary-row">
                    <span class="summary-label">Скидка ({{ order.discount_percent }}%):</span>
                    <span class="summary-value">-${{ order.discount_amount }}</span>
                </div>
                {% endif %}
                <div class="summary-row">
                    <span class="summary-label">Стоимость доставки:</span>
                    <span class="summary-value">${{ order.delivery_cost }}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Оформление документов:</span>
                    <span class="summary-value">${{ order.document_cost }}</span>
                </div>
                <div class="summary-row total-row">
                    <span class="summary-label">Общая сумма:</span>
                    <span class="summary-value">${{ order.total }}</span>
                </div>
            </div>
        </div>

        <div class="actions">
            <a href="" class="btn btn-outline">Вернуться к заказам</a>
            {% if order.status == 'new' %}
            <a href="#" class="btn btn-primary">Оплатить заказ</a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock content %}