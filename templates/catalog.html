    {% extends 'base.html' %}
    {% load static %}
    {% block content %}
    <link rel="stylesheet" href="{% static 'css/catalog.css' %}">
        <!-- Header -->


        <!-- Main Content -->
        <section class="py-4">
            <div class="container">
                <div class="row">
                    <!-- Filters Sidebar -->
                    <div class="col-lg-3 mb-4 d-none d-lg-block">
                        <div class="filters-card">
                            <form method="get" class="filters-card">

                                <!-- Manufacturer Filter -->
                                <div class="filter-group">
                                    <div class="filter-title">Производитель</div>
                                    {% for man in manufacturers %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="manufacturer" value="{{ man.id }}"
                                                id="manufacturer-{{ man.id }}"
                                                {% if man.id|stringformat:"s" in selected_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label" for="manufacturer-{{ man.id }}">
                                                {{ man.name }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Algorithm Filter -->
                                <div class="filter-group mt-3">
                                    <div class="filter-title">Алгоритм</div>
                                    {% for algo in algorithms %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="algorithm" value="{{ algo }}"
                                                id="algo-{{ forloop.counter }}"
                                                {% if algo in selected_algorithms %}checked{% endif %}>
                                            <label class="form-check-label" for="algo-{{ forloop.counter }}">
                                                {{ algo }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Price Filter -->
                                <div class="filter-group mt-3">
                                    <div class="filter-title">Цена</div>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="number" name="price_from" class="form-control" placeholder="от" value="{{ price_from }}">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" name="price_to" class="form-control" placeholder="до" value="{{ price_to }}">
                                        </div>
                                    </div>
                                </div>

                                <!-- Stock Filter -->
                                <div class="filter-group mt-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="in_stock" value="1"
                                            id="in-stock" {% if in_stock %}checked{% endif %}>
                                        <label class="form-check-label" for="in-stock">
                                            В наличии
                                        </label>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="filter-group mt-4">
                                    <button type="submit" class="btn btn-primary w-100">Фильтровать</button>
                                </div>

                            </form>
                        </div>
                    </div>
                    
                    <!-- Products Grid -->
                    <div class="col-lg-9">
                        <div class="mb-2">
                            <form method="get" class="filters-card">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="text-muted m-2">Найдено {{ product_count }} товара</span>
                                <select class="form-select form-select-sm" name="sort" onchange="this.form.submit()" style="width: auto;">
                                    <option value="">По популярности</option>

                                    <option value="price_asc" {% if request.GET.sort == "price_asc" %}selected{% endif %}>
                                        По цене ↑
                                    </option>

                                    <option value="price_desc" {% if request.GET.sort == "price_desc" %}selected{% endif %}>
                                        По цене ↓
                                    </option>

                                    <option value="new" {% if request.GET.sort == "new" %}selected{% endif %}>
                                        Новинки
                                    </option>
                                </select>

                            </div>
                        </form>
                        </div>
                        <button class="btn btn-primary mb-2 d-block d-lg-none mb-3" style="width: 100%;" onclick="openFilterModal()">Фильтровать</button>

                        <div class="product-grid">
                            {% for i in products %}
                            <div class="product-card">
                                <a href="{% url 'asic:detail' i.id %}">
                                    <div style="position: relative;">
                                        <img src="{{i.images.url}}" alt="{{i.name}}" class="product-image">
                                        {% if i.is_featured %}
                                        <div class="product-badge">FEATURED</div>
                                        {% endif %}
                                    </div>
                                </a>
                                <div class="product-body">
                                    <div class="product-brand">{{i.manufacturer.name}}</div>
                                    <h5 class="product-title">{{i.name}} {{i.hash_rate}} TH/s</h5>
                                    <ul class="product-specs">
                                        <li><span>Алгоритм:</span> <span>{{i.algorithm}}</span></li>
                                        <li><span>Хешрейт:</span> <span>{{i.hash_rate}} TH/s</span></li>
                                        <li><span>Потребление:</span> <span>{{i.power_consumption}} Вт</span></li>
                                    </ul>
                                    <div class="product-price-container" style="display: flex;justify-content: space-between;">
                                        <div class="product-price text-danger">${{i.current_price}}</div>
                                        {% if i.has_discount %}
                                        <div class="product-price-old text-decoration-line-through">${{i.price}}</div>
                                        {% else %}
                                        <span class="text-decoration-line-through">{{ i.old_price }} USD</span>
                                        {% endif %}
                                    </div>
                                    <div class="product-actions">
                                        <a href="{% url 'asic:add_buy' i.id %}">
                                            <button class="btn btn-primary-custom">
                                            <i class="fas fa-cart-plus me-1"></i>Купить
                                        </button>
                                        </a>
                                        <a href="{% url 'asic:add_to_cart' i.id %}">
                                            <button class="btn btn-outline-custom">
                                                <i class="fas fa-cart-plus"></i>В корзину
                                        </button>
                                        </a>
                                    </div>
                                </div>
                            </div>                        
                            {% endfor %}
                        </div>
                        <!-- Pagination -->
                        {% include 'partials/pagination.html' %}
                    </div>
                </div>
            </div>
        </section>  

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Modal ochish funksiyasi -->
    <script>
      function openFilterModal() {
        const modalElement = document.getElementById('filterModal');
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
      }
    </script>

        <div class="modal fade" id="filterModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Фильтр</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
        </div>

        <div class="modal-body">
                            <form method="get" class="filters-card">

                                <!-- Manufacturer Filter -->
                                <div class="filter-group">
                                    <div class="filter-title">Производитель</div>
                                    {% for man in manufacturers %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="manufacturer" value="{{ man.id }}"
                                                id="manufacturer-{{ man.id }}"
                                                {% if man.id|stringformat:"s" in selected_manufacturers %}checked{% endif %}>
                                            <label class="form-check-label" for="manufacturer-{{ man.id }}">
                                                {{ man.name }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Algorithm Filter -->
                                <div class="filter-group mt-3">
                                    <div class="filter-title">Алгоритм</div>
                                    {% for algo in algorithms %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="algorithm" value="{{ algo }}"
                                                id="algo-{{ forloop.counter }}"
                                                {% if algo in selected_algorithms %}checked{% endif %}>
                                            <label class="form-check-label" for="algo-{{ forloop.counter }}">
                                                {{ algo }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>

                                <!-- Price Filter -->
                                <div class="filter-group mt-3">
                                    <div class="filter-title">Цена</div>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="number" name="price_from" class="form-control" placeholder="от" value="{{ price_from }}">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" name="price_to" class="form-control" placeholder="до" value="{{ price_to }}">
                                        </div>
                                    </div>
                                </div>

                                <!-- Stock Filter -->
                                <div class="filter-group mt-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="in_stock" value="1"
                                            id="in-stock" {% if in_stock %}checked{% endif %}>
                                        <label class="form-check-label" for="in-stock">
                                            В наличии
                                        </label>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="filter-group mt-4">
                                    <button type="submit" class="btn btn-primary w-100">Фильтровать</button>
                                </div>

                            </form>
        </div>
        </div>
    </div>
    </div>
    {% endblock content %}
